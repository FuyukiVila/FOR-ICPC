/*

                                                        $u-u------%                                                                                         3+--%-;;;;6
                                                       %;-i-------3                                                                                         %--!;;;;;; 6
                                                     %;$-+-------+                                                                                          %-;;;;;;;;+.n
                                                     %;$-+-------+                                                                                          %-;;;;;;;;+.n
                                                   %-;8--------z                                                                                          %-8;;;*;;;;;;.a
                                                 vv--;vi------a                                                                                         z-%;;;;--+;;;;;; %
                                                % ---;8-------                                                                                         8z;;;+-----;;;;;; %                                         @@@@@##@@@@@
                                               % ----;;.^----!                                                                                       %;;;;--------;;;;;;*%                                     @@                @@
                                               % ----;;;!-u-a                                                                                      %-;+-----------;;;;;;~u                                  6@                      @&
                                              % ------;;;;8-%%                                                                                  ;^ ---------------;;;;;;%                                  @                          @+
                                              % -------^;;;;o-%                                         +u386i^nv~                              * ---------------;;;;;;$;%                               @6                            v@
                                              % ---------;;;;;;$                              v%o.......................%%.                      ----------------;;;;;$no-1                             @*                              .@
                                              % ----------^;;;;;!$                        %i..................................o%~              % ---------------*;;;;vv$---%                           u@        u~~~au   uz~~~~an       $$
                                              u%------------;;;;;;83                  %+..........................................u%u          3.-------------- ;;;$vv3--+--6                          @       zv~~~~~~~u~~~~~~~~~u       @
                                               %8v-----------^;;;;;;$o            -%..................................................6%;     ^-------------- .;;;vvv3--;;;-v                          @       u~~~~~~~~~~~~~~~~~~u       @
                                                %v$------------;;;;;;;$3        %.........................................................%%   $-------.    +;;;$vvv6--;;;---%                         @       n~~~~~~~~~~~~~~~~~vn       @
                                               %.%vz------------+;;;;;;$     % ..............................................................u% -$8;;;;;;;;;;;$vvvv$--;;;;+---8                        @        *z~~~~~~~~~~~~~~va        @
                                              ----!vvv-----------;;;;;;$  6%....................................................................%%  *%6%$1;;$vvvvv$--;;;;;----%                        @~         uu~~~~~~~~~~~u         .@
                                              %--;- vva---------;;;;;;;$%8..................................................................+.....-%%-%vvvvvvvvvv%- ;;;;;;-----%                        @            uu~~~~~uu           @
                                             %---;;* nvv%-----;;;;;;;;$v......................................................................%.....-%------      -;;;;;;;*----8                         @              u~u             @
                                             %----;;;- !vvv8;;;;;;;;1$^..  ....................................................................-....  *o*;**^--- -;;;;;;;;*------%                        @3                          n@
                                             1----;;;;-  $vvvvv6$~;%...  ........................................................................+.     $;;;;;;;;;;;;;;;;;;--------%                        @.                       @
                                            %-----+;;;;;-   v$$$6o%..  ...   ................................................................. ...i      nn;;;;;;;;;;;;;;;;---------+%                        @                   @@
                                            %------;;;;;;-------1%..  ...      .............................................................    ...-      .$;;;;;;;;;;;;;;;^----------;%                      @        @@@@   6@@!
                                          u+-------;;;;;;;;;;;;%3.. .... .         .......................................................       ..-.      .$;;;;;;;;;;;;;;;------------6!                   @  +#@@@
                                         %----------;;;;;;;;;;36.. ... .           ..  .z.....................................      . ....        ..%.     ..%;;;;;;;;;;;;;;;-------------%
                                        %----------;;;;;;;;;;v%...........        .....3.........     .......     .............     . ......      ............un;;;;;;;;;;;;;;-------------%.
                                      o-----------;;;;;;;;;;;%.......................%.....      .    .......      .............     ..~........  ...6.........~n;;;;;;;;;;;;;;+------------~%
                                     %-----------;;;;;;;;;;;%......................-!%.....      ..   ........     ....~....%...........%............~..........%;;;;;;;;;;;;;;;;-------------%
                                    %-----------;;;;;;;;;;;$......................%^^i..........  .   ....o.....   .....%...!^$.........*!..........  ...........$;;;;;;;;;;;;;;;;-------------u
                                  a.----------;;;;;;;;;;;;$;..... ...............$^^ i.....................%...............6^^ a-........*..........  -........**$;;;;;;;;;;;;;;;;;*------------^n
                                 %----------;;;;;;;;;;;;;;$.....z .............+a^^  %.....................$6............-.!^    %.......*$.........  3......^**%;;;;;;;;;;;;;;;;;;;;-----------  %
                                %---------;;;;;;;;;;;;;;;$-..... .............^v^^   *.....................$*;u...........+$      %......**.......... %....-***$;;;;;;;;;;;;;;;;;;;;;;-----------  %
                               8 --------;;;;;;;;;;;;;;;;$.....^ ............+$^^   ..%....................%*^*$.........6%^...-n8%%%-....*$......... 1....^****%;;;;;;;;;;;;;;;;;;;;;;;---------- %%
                              ! -------;;;;;;;;;;;;;;;;;8z.....8 ...........-$$$......;-.*8................***.+*$...........+6%%8-....6..**......... o.......-**$;;;;;;;;;;;;;;;;;;;;;;;--------- %
                             % ------;;;;;;;;;;;;;;;;;;;$...................$818       %....................~*...-*$v...........%     %%..^*a........ o...........%;;;;;;;;;;;;;;;;;;;;;;-------- %1
                            % -----;;;;;;;;;;;;;;;;;;;;;$.....z ...........**^+.        %...................$*......*!$...........-%   %...*$........ %............%;;;;;;;;;;;;;;;;;;;;-------- %!
                            % ------;;;;;;;;;;;;;;;;;;;~%.....% ...........$^^..         %..................-*.......%^^%8...........%6 %..*o........ 6............%z;;;;;;;;;;;;;;;;;;-------- %
                            %  -----;;;;;;;;;;;;;;;;;;;~$.....- ..........n^^...          %..................$*.....%^^    %6...........%6.**u....... -........^*-.$;;;;;;;;;;;;;;;;;--------- %
                            %!  -----;;;;;;;;;;;;;;;;;;;3..... ...........$^^..            %..................%....%^^        %8..........-%*%...... 6...-********$;;;;;;;;;;;;;;;;;--------.-%
                             -%  -----;;;;;;;;;;;;;;;;;;;%...+ ..........*~^^.              %.................o+..%^^            %%..........%...... -***********%u;;;;;;;;;;;;;;;---------^61~
                               %1 -----;;;;;;;;;;;;;;;;;;;%..! ..........n^^..               ~%................%.%^^                 %%......%..... %***********%!;;;;;;;;;;;;;;---------%;;+$
                                 %. ----;;;;;;;;;;;;;;;;;;;%.% ..........$^^                   %................$^^                       %%+3..... .-$n*******%~;;;;;;;;;;;;--------;$;;;*-$
                                  *% -----;;;;;;;;;;;;;;;;;;%% ..........$^^           ;ii-      %..............^z.      %%%%%%%%%%^         8.... %.......1$6$;;;;;;;;---------^$v;;;;;;-$
                                    -% -----;;;;;;;;;;;;;;;;o% ..........$^^       !%%%%%%%%%%     %u.....%!-....8+     888!     8%%%        %....i%***$%!-.+--;~~z%%$8!66!~;;;;;;;;;;;n$
                                       %+.----;;;;;;;;;;;;;;;$  .........%^^     .%%%i     n%%%^     ~%-..n*!.%...$   z886         888v      a...-.zo%-     6u^^^^^*$;;;;;;;;;;;;;;;%$
                                          o8..----;;;;;;;;;;;~  .........a^.    a%%8         ^8%6       z%3     -%%;u 66 .........  688     %... ..-    %^^^^^^^^^$*****%%o%$%$$v
                                           8.;;;~6$6---^;;;;;;$ .........-o     888            88                     ...............668    i.. ;....%1^^^*.^^^^%********$**...%v
                                             $ ;;;;;;;;;;;;;;;~. .........3    *86  ..........                      ...................    %...a^-..v^^^^ ...3-..$*******3***...%
                                               ^6 ;;;;;;;;;;;;;$ .........%     i!..............                    ....................  *-..6^^o..!^^$ ....%6...3******@****...%
                                                  -%~;;;;;;;;;;;$ ........-*    ...;...;^..;......                 .........;...;...;;... %.-8^-^n.-68$^....u.....$***********...^%
                                                    %.&@~;;;;;u%*%.........%   ...;...;;..;+......                 ........;...;+..^;....%.;v.  ^o..6***$...... .%******n*****^...%
                                                  *....@***********%........%  ...;...;..+;.......           .i%$$$%%..........;...;....%.8^    ^...%****%^^....%**************...%*
                                                  .....v*************$.......% ...................  $;;;;;;;;;;;;;;;;6.................;*$.    6$...$******$...%*****&*********...86
                                                 %.....*8*************;.%+....% ..................  6;;;^+++++++++++..3................%-    3**$...%*******$-%***~************-..n!
                                                 ......^**;************...-8%% % ...............    8..+++++++++++++++6.............. %   !;****%...%**********;n**************+..%
                                                 *.....+***@***********....$i      ...........      ;*+++++++++++++++%     ......   .  ^$*******....%*******~u*****************.-%
                                                 %.....+*****6*********....&*%$                           -++++++++-                n%**********-...u*****i********************@
                                                  %....+*******#*******....@****%%^                                             6%  %***********i....o*@*********************@;
                                                   8...-*********#*****....@*********%$%    %                                ~%       $***********%....$*********************##
                                                zo  $..-*************@&....@***********$%     %%;  % %               i%             +%***********....+*******************@*$
                                              i-     -+-**************@....@**********;$               %%%+^^^^^^^^^%%%              %*********3;8....$****************$**%  %%
                                            v^        8@*************1.....@*********3$                 ~+^^^^^^^^^^$**z              %*******$**%.....$**************n***$    !6
                                           %  ....    .!*v***********..... @********$$                  **z**$^^$***~***               %a***@*****+.....8***********$****~-..    %
                                          o ... ...... %**~********&.....  ;@*****i%                    $v***;*i****$n*6                3$*@******$ .....%*********@*****6 ...     %
                                        .. ..      ... $**********3.....  @**&***$                      %8*v*****%***$*3                  &6*******.  ....-$******@******u+  ..     %
                                        a  ........ .. ;****@***#+-^%@@#*****@$3%                    .%**--*$*******v*$$%                   $3********8%%%%$$$***v********%  ...     %
                                       %  ........... %*****@**************%%.  .. o%       8%%~--^o@+--;-***~n*****i*~o*~@**u$$.         %1...$%****************o********61 ...      %
                                       . ........^o$$*******#***********n$  ..  ..     -%%%%~----***&--***;z****u$$6**o***#*****!$z%%%%~    ..    .n$%*********************z%...      ~3
                                      8 ......13688%%%%%%%%%%886666666%%6666666666668%63iiiii8!!!!333%666%8%%%%%%%%%%%%%%%%%%%%!6!!!iii%%iiiiiiiiiiii11ua%%%aaaau$i!!!!!!!!!!$....     %
                                      % ......%                                                                                                                              %v%....   i;
                                      ! ......%                                                                                                                              %$$%8...   !
                                      u .....z%                                                                                                                              %.~....... %
                                      % ...!  %                                                                                                                              %  i...... %
                                      %   %   %                                                                                                                              %    %.... 8
                                      o  !    %                                      a                                                                                       %     %...~
                                       u u    %                                    aaaa                                                                                      %      %..%
                                       %%     %                                   aaaaaaaaaaaaaaaaav                  aaaaaaaaaaaaaaaaaaaaaaaaaa                             %       %.%
                                             3%                                 aaaz          aaaa                                        aaaaaz                             %        %
                                            %-%                               aaaa           aaa                                       aaaaa                                 %u
                                          %o%%%                             aaaaaaaaaaaaaaaaaaaaaaaaaa                              aaaaa                                    %uv
                                         %%-----%                           a                      +aa                           aaaaa-                                      %%%v
                                        z%%--i%--%                            zaavnoooooooooooooooonaa                           -aaa                                      %^---%.
                                       .+%%-----*%                            zaazzzzzzzzzzzzzzzzzzzaa                            aaa                                     ^-----%%+
                                        +%%v-----%                                                 +aa                            aaa                                     %-+---%%+
                                        %%%%----;%                            aaaaaaaaaaaaaaaaaaaaaaaa                            aaa                                    %------%.3
                                 +1..+1   i%------i                                       v         a                             aaa                                     %-----%       3n%
                              i.....+ . *  %%-i18%                           aaz  ^aa    oaaa      ^aaa                           aaa                                    i6-----%      !a.&..o+
                            -...   ... 8.o  %%-~%%                          aaa   -aa      aa        zaaa                         aaa                                     %----%8     %.....@....%
                         1  ..   ..#.. .. .6  %                            aaa    ^aa            aaa   aaa                       -aaa                                      %%%%      %.....  .... ..8
                       %   ..   .. ... .6. .- %                           aaa      aaaaaaaaaaaaaaaa                         .aaaaaaan                                        %      %......  ..6..  .. ^
                     8 ..  .....  z...  ..... %                                                                              aaaaaz                                          %     o ....... .. @ .. ..  6
                   %.........    -  .....i... %                                                                                                                              %    +  ...   ....  a ..... .. .
                 % ..  ...  .... n......      %                                                                                                                              %   -  ... -   ...    .. .... .. 6
               u  ..  .......... .........- ..%                                                                                                                              %  - ......@... ......-..     ..   6
              -  ...   . ..  ...@.. ......v...%                                                                                                                              % ^  ..  ....... .. ...!...    ..    .
            %    .. ......   ...... ..........%                                                                                                                              %.   .    ... ..  .. ...@.........   .8
           ^     ..  ....   ...6...........1..%                                                                                                                              %    .  ..- . ...........i..............z
         %      ...     ...................a..%                                                                                                                              %   .. ...@..............................3
        ..    ....    ........................%                                                                                                                              %.... ....................+............... ~
      % .........   ..........$.............% %888888*v~nnnnnv!6668888888%%%%%%%%%%%%%%%%88%%%%%8%8%%%%%8888888%88888888888888%8%8866666888888888888888888888888888888888un~+%     ...~.................@................%
     8  ......     ......................... .  ..%--+8+-----*****$--*;*%**************$!%z;;;;;@#;;;;@+++;;+++++++;%++.@;;;;;;;;;;;&!$*************;*@@*u******---%-oa-%..  ..    ...@..................$.................
   ^......         ..................... .........-----%-----*****a--***$**************%  .+;@;;;;;;;@++++8;;+++++++*+++ o;;;;;~#;;;;;;;$***********;*u;*;******---~-++-+..  .. ..........................-.................%
  %... ....    ..............i..........  .. 1...%-----%-----******--*;a3************z3  ++++ ++%;;6++++++++#;++++*+++++. o;~;;;;;;;;;;;;@**********~*o;*o******+---%-;--1.       ...u.................................. ....;

*/


#define GKD std::cin.tie(nullptr)->std::ios::sync_with_stdio(false)
#define clr(a, b) memset(a, b, sizeof(a))
#define cpy(a, b) memcpy(a, b, sizeof(a))
//#define LOCAL
#define PRIME

#include <bits/stdc++.h>

#ifdef LOCAL

#define dbg(x...) do { std::cout << #x << " -> "; err(x); } while (0)

void err() { std::cout << std::endl; }

template<class T, class... Ts>
void err(T arg, Ts &...args) {
    std::cout << arg << ' ';
    err(args...);
}

#else

#define dbg(x...) 114514;

#endif

using namespace std;
using ll = long long;

#ifdef PRIME

const int N = 1e7 + 5;
vector<int> minp(N);
vector<int> primes;
bitset<N> st;

unordered_map<int, int> hashmap;

void get_primes(int n) {
    for (int i = 2; i <= n; i++) {
        if (!st[i]) {
            if (primes.size() < 500) {
                hashmap[i] = primes.size();
            }
            minp[i] = i, primes.emplace_back(i);
        }
        for (int j = 0; primes[j] * i <= n; j++) {
            int t = primes[j] * i;
            st[t] = true;
            minp[t] = primes[j];
            if (i % primes[j] == 0)
                break;
        }
    }
}

#endif

int id = 0;

inline void init() {
    /*Init Here*/
    get_primes(1e7);
//    cout << primes.size() << '\n';
}

int lastans = 0;
int zs[450];
unordered_map<int, int> cp;

// 446 3163
void idol_produce(int testCase) {
    /*Code Here*/
    int n, q;
    cin >> n >> q;
    vector<int> a(n + 1);
    for (int i = 1; i <= n; i++) {
        cin >> a[i];
    }
    vector<int> p;
    int maxlen = 1000;
    vector<vector<int> > c(n + 1);
    c[0].resize(450);
    unordered_map<int, int> cnt;
    for (int i = 1; i <= n; i++) {
        c[i] = c[i - 1];
        int tmp = a[i];
        while (tmp != 1 && minp[tmp] < 3163) {
            zs[hashmap[minp[tmp]]]++;
            tmp /= minp[tmp];
        }
        for (int x = 0; x <= 446; x++) {
            c[i][x] += (zs[x] % 2 == 1);
        }
        if (tmp != 1) {
            cnt[tmp]++;
            p.emplace_back(i);
        }
        a[i] = tmp;
        clr(zs, 0);
//        assert(c[i].size() < 500);
    }
    vector<unordered_map<int, int>> c2(n + 1);
    for (int i = 1; i <= n; i++) {
        c2[i] = c2[i - 1];
        if (cnt[a[i]] > maxlen / 2) {
            c2[i][a[i]]++;
        }
//        assert(c2[i].size() < 500);
    }
    while (q--) {
        cp.clear();
        int l, r;
        cin >> l >> r;
        l ^= lastans, r ^= lastans;
//        if (l == 0) l = 1;
//        if (r >= n) r = n;
        int len = r - l + 1;
        if (len <= 1) {
            cout << 0 << '\n';
            lastans = 0;
            continue;
        }
        if (len <= maxlen) {
            int ans = 0;
//            for (auto const &[x, y]: c[r]) {
//                auto k = c[l - 1].find(x);
//                if (k != c[l - 1].end()) {
//                    int cnt = y - (k->second);
//                    ans += min(cnt, len - cnt);
//                } else {
//                    int cnt = y;
//                    ans += min(cnt, len - cnt);
//                }
//            }
            for (int i = 0; i < 450; i++) {
                int w = c[r][i] - c[l - 1][i];
                ans += min(w, len - w);
            }
            for (int i = l; i <= r; i++) {
                if (a[i] != 1) cp[a[i]]++;
            }
            for (auto const &[x, y]: cp) {
                ans += min(y, len - y);
            }
            cout << ans << '\n';
            lastans = ans;
        } else {
            int ans = 0;
            for (int i = 0; i < 450; i++) {
                int w = c[r][i] - c[l - 1][i];
                ans += min(w, len - w);
            }
//            for (auto const &[x, y]: c[r]) {
//                auto k = c[l - 1].find(x);
//                if (k != c[l - 1].end()) {
//                    int cnt = y - (k->second);
//                    ans += min(cnt, len - cnt);
//                } else {
//                    int cnt = y;
//                    ans += min(cnt, len - cnt);
//                }
//            }
            int length = upper_bound(p.begin(), p.end(), r) - lower_bound(p.begin(), p.end(), l);
            int w = 0;
//            for (int i = 0; i < id; i++) {
//                int cnt = c2[r][i] - c2[l - 1][i];
//                w += cnt;
//                ans += min(cnt, length - cnt);
//            }
            for (auto const &[x, y]: c2[r]) {
                auto k = c2[l - 1].find(x);
                if (k != c2[l - 1].end()) {
                    int cnt = y - (k->second);
                    w += cnt;
                    ans += min(cnt, len - cnt);
                } else {
                    int cnt = y;
                    w += cnt;
                    ans += min(cnt, len - cnt);
                }
            }
            ans += length - w;
            cout << ans << '\n';
            lastans = ans;
        }
    }

}

signed main() {
    GKD;
    init();
    int T = 1;
//    cin >> T;
    for (int i = 1; i <= T; i++) {
        idol_produce(i);
    }
    return 0;
}
